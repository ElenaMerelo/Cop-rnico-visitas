---
title: Evolución de la notoriedad de la página de Nicolás Copérnico en la Wikipedia
  española
author: "JJ Merelo"
date: "9 de enero de 2017"
output: html_document
bibliography: refs.bib
abstract: |
  A consecuencia de un vídeo que se ha hecho viral en estos días y en los que se menciona a Copérnico, la figura ha recibido una cantidad considerable de atención en estos días. Veamos exactamente cuanta y cómo ha evolucionado a lo largo del tiempo.
---

#Introducción

La wikipedia, a través de un interfaz, permite acceder a las visitas de cada una de las diferentes páginas creadas en ella. Es un interfaz de tipo REST al que se puede acceder directamente. Lo hacemos mediante este *script*:

~~~
curl https://wikimedia.org/api/rest_v1/metrics/pageviews/per-article/es.wikipedia/all-access/all-agents/Nicol%C3%A1s_Cop%C3%A9rnico/daily/2017010100/2017010900 | jq '.items[] | .views ' > 2017.dat
curl https://wikimedia.org/api/rest_v1/metrics/pageviews/per-article/es.wikipedia/all-access/all-agents/Nicol%C3%A1s_Cop%C3%A9rnico/daily/2016010100/2016010900 | jq '.items[] | .views ' > 2016.dat
~~~
que usa `curl` para descargarse el fichero, sin más complicación que codificar como URI el nombre de la página, justo destrás de `all-agents`, y poner como dos últimos parámetros las dos fechas en las que nos movemos, desde principios de año hasta ahora. Como esto descarga un fichero en JSON, extraemos el dato que nos interesa: las visitas, y lo vertimos en sendos ficheros de datos.

Estos datos los vamos a procesar con R para convertirlos en un sólo conjunto:
```{r setup}
library(ggplot2)
library(ggthemes)
datos.2016 <- read.table('2016.dat')
datos.2017 <- read.table('2017.dat')
datos <- data.frame( dia=c(1:nrow(datos.2016),1:nrow(datos.2017)),
                    year=c(rep('2016',nrow(datos.2016)),rep('2017',nrow(datos.2017))),
                    visitas=c(datos.2016$V1,datos.2017$V1))
```


A continuación trazamos los datos de cada día, por año. 

```{r imagen}
ggplot(datos,aes(x=dia,y=visitas,group=year,col=year))+geom_line()+theme_tufte()
```

# Evolución en el ránking de páginas visitadas

La wikipedia también ofrece en su API el ránking de las mil primeras páginas vistas, que se extraen con este script:
~~~
curl https://wikimedia.org/api/rest_v1/metrics/pageviews/top/es.wikipedia/all-access/2017/01/07 | jq '[ .items[] | .articles[] |{articulo:.article,puesto: .rank,visitas:.views} ]' > ranking-070117.json
~~~
que genera, en formato JSON, un fichero con las visitas, el puesto que ocupa cada artículo y el artículo en sí.

En el *script* siguiente lo leemos y lo trazamos para dos días seguidos.

```{r ranking}
library(jsonlite)
ranking.07 <- fromJSON("ranking-070117.json")
ggplot(ranking.07[1:20,],aes(x=puesto,y=visitas)) + geom_bar(stat="identity")+ geom_text(aes(label=articulo),color='blue',angle=90)
ranking.08 <- fromJSON("ranking-080117.json")
ggplot(ranking.08[1:20,],aes(x=puesto,y=visitas)) + geom_bar(stat="identity")+ geom_text(aes(label=articulo),color='blue',angle=90)
ranking.09 <- fromJSON("ranking-090117.json")
ggplot(ranking.09[1:20,],aes(x=puesto,y=visitas)) + geom_bar(stat="identity")+ geom_text(aes(label=articulo),color='blue',angle=90)
```

De no estar entre las 1000 páginas con más visitas el día anterior, ha entrado directamente en el número 11, ligeramente detrás de los Reyes Magos el día 7 y de la película que, al parecer, estaban poniendo en alguna televisión, Capitán Phillips. 

#Conclusión

Las visitas a día equivalente se han multiplicado por 15, más o menos. Será interesante ver cómo decaen de aquí en adelante.

Todos los datos y ficheros necesarios están en http://github.com/JJ/Cop-rnico-visitas, con una licencia libre. Este artículo extiende [@merelo17] añadiendo la evolución temporal y también la posición en los ránkings. 

## Bibliografía
